'use strict';

(function () {
  //timer
  var display = document.querySelector('.time'),
      anim = void 0,
      watch = void 0,
      displayBreak = document.querySelector('.break-time'),
      watchBreak = void 0,
      animBreak = void 0;

  // define function for setInterval
  function getSeconds(hour) {
    var min = hour.textContent.split(':');
    return parseInt(min[0], 10) * 60;
  }
  // define function for setInterval
  function circularLoop(init, min, action) {
    var current = init;
    return function () {
      action(current);
      if (current - 1 === min) {
        current = min;
      } else if (current > 0) {
        current--;
      }
    };
  }
  watch = function watch() {
    var seconds = void 0,
        minutes = void 0;
    anim = setInterval(circularLoop(getSeconds(display), 0, function (currSecond) {
      //parseInt() return integer ex 110/ 60 = 1.83333 with parseInt it's 1
      //I'm using Math.floor, both do the same work
      minutes = parseInt(currSecond / 60, 10);
      // seconds = 122s / 60 = 120 and remain 2
      seconds = parseInt(currSecond % 60, 10);

      //print a 0 first if minuste is less than 10 minutes 
      minutes = minutes < 10 ? "0" + minutes : minutes;
      seconds = seconds < 10 ? "0" + seconds : seconds;
      display.textContent = minutes + ":" + seconds;

      if (currSecond === 0) {
        clearInterval(anim);
        watchBreak();
      }
    }), 1000);
  };
  watchBreak = function watchBreak() {
    var seconds = void 0,
        minutes = void 0;
    animBreak = setInterval(circularLoop(getSeconds(displayBreak), 0, function (currSecond) {
      minutes = parseInt(currSecond / 60, 10);
      seconds = parseInt(currSecond % 60, 10);
      minutes = minutes < 10 ? "0" + minutes : minutes;
      seconds = seconds < 10 ? "0" + seconds : seconds;
      display.textContent = minutes + ":" + seconds;
      if (currSecond === 0) {
        clearInterval(animBreak);
      }
    }), 1000);
  };
  //END TIMER

  //Event + and -
  //
  var sessionPlus = document.querySelector('.session__plus'),
      sessionMinus = document.querySelector('.session__minus'),
      breakPlus = document.querySelector('.break__plus'),
      breakMinus = document.querySelector('.break__minus'),
      time = document.querySelector('.time'),
      breakTime = document.querySelector('.break-time'),
      play = document.querySelector('.play'),
      stop = document.querySelector('.icon-stop'),
      pause = document.querySelector('.pause');

  function previousMinus(e) {
    var prev = this.previousSibling,
        val = parseInt(prev.textContent, 10);
    if (val > 0) {
      prev.textContent--;
      if (val === 1) {
        prev.classList.add('alert');
      }
    }
    if (!this.classList.contains('break__minus')) {
      time.textContent = prev.textContent + ':00';
      clearInterval(anim);
    } else {
      breakTime.textContent = prev.textContent + ':00';
    }

    play.classList.add('show');
    play.classList.remove('hide');
    pause.classList.add('hide');
    pause.classList.remove('show');
    stop.classList.remove('show');
    stop.classList.add('hide');

    e.preventDefault();
  }
  function nextPlus(e) {
    var next = this.nextSibling;
    var val = parseInt(next.textContent, 10);
    next.textContent++;
    if (val === 0) {
      next.classList.remove('alert');
    }
    if (!this.classList.contains('break__plus')) {
      time.textContent = next.textContent + ':00';
      clearInterval(anim);
    } else {
      breakTime.textContent = next.textContent + ':00';
    }
    play.classList.add('show');
    play.classList.remove('hide');
    pause.classList.add('hide');
    pause.classList.remove('show');
    stop.classList.remove('show');
    stop.classList.add('hide');
    e.preventDefault();
  }

  sessionMinus.addEventListener('click', previousMinus);
  sessionPlus.addEventListener('click', nextPlus);
  breakMinus.addEventListener('click', previousMinus);
  breakPlus.addEventListener('click', nextPlus);
  play.addEventListener('click', playPodomoro);
  pause.addEventListener('click', pausePodomoro);
  stop.addEventListener('click', stopPodomoro);

  function playPodomoro(e) {
    watch(display);
    play.classList.add('hide');
    play.classList.remove('show');
    pause.classList.add('show');
    pause.classList.remove('hide');
    stop.classList.remove('hide');
    stop.classList.add('show');
    stop.classList.remove('pause');
  }
  function pausePodomoro(e) {
    clearInterval(anim);
    play.classList.add('show');
    play.classList.remove('hide');
    pause.classList.add('hide');
    pause.classList.remove('show');
    stop.classList.add('pause');
  }
  function stopPodomoro(e) {
    clearInterval(anim);
    clearInterval(animBreak);
    play.classList.add('show');
    play.classList.remove('hide');
    pause.classList.add('hide');
    pause.classList.remove('show');
    stop.classList.remove('show');
    stop.classList.add('hide');
    var sessionTime = document.querySelector('.session__time ').innerHTML;
    time.textContent = sessionTime + ':00';
  }
  //SVG
  //transform second to perimetre
  //path(stroke-dasharray='472', stroke-dashoffset='0.00', \
  //1== 1s donc 472 sec = 7.8 minutes soit 472/60 pour avoir les minutes
  //min * 60 = seconds 
  //donc 10min * 60 on obtient le resutat en seconde et le diametre du 
  //perimetre
  var distancePerPoint = 1;
  var drawFPS = 1000 / 10;
  var orig = document.querySelector('path'),
      length = void 0,
      timer = void 0;

  orig.addEventListener('mouseover', startDrawingPath, true);
  orig.addEventListener('mouseout', stopDrawingPath, true);

  function startDrawingPath() {
    length = 0;
    orig.style.stroke = '#f60';
    timer = setInterval(increaseLength, 1000);
  }

  function increaseLength() {
    var pathLength = orig.getTotalLength();
    length += distancePerPoint;
    //length=0 and path lenght = stroke-dasharray soit 472
    orig.style.strokeDasharray = [length, pathLength].join(' ');
    console.log([length, pathLength].join(' '));
    if (length >= pathLength) clearInterval(timer);
  }

  function stopDrawingPath() {
    clearInterval(timer);
    orig.style.stroke = '';
    orig.style.strokeDasharray = '';
  }
})(); //END
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdC5qcyJdLCJuYW1lcyI6WyJkaXNwbGF5IiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiYW5pbSIsIndhdGNoIiwiZGlzcGxheUJyZWFrIiwid2F0Y2hCcmVhayIsImFuaW1CcmVhayIsImdldFNlY29uZHMiLCJob3VyIiwibWluIiwidGV4dENvbnRlbnQiLCJzcGxpdCIsInBhcnNlSW50IiwiY2lyY3VsYXJMb29wIiwiaW5pdCIsImFjdGlvbiIsImN1cnJlbnQiLCJzZWNvbmRzIiwibWludXRlcyIsInNldEludGVydmFsIiwiY3VyclNlY29uZCIsImNsZWFySW50ZXJ2YWwiLCJzZXNzaW9uUGx1cyIsInNlc3Npb25NaW51cyIsImJyZWFrUGx1cyIsImJyZWFrTWludXMiLCJ0aW1lIiwiYnJlYWtUaW1lIiwicGxheSIsInN0b3AiLCJwYXVzZSIsInByZXZpb3VzTWludXMiLCJlIiwicHJldiIsInByZXZpb3VzU2libGluZyIsInZhbCIsImNsYXNzTGlzdCIsImFkZCIsImNvbnRhaW5zIiwicmVtb3ZlIiwicHJldmVudERlZmF1bHQiLCJuZXh0UGx1cyIsIm5leHQiLCJuZXh0U2libGluZyIsImFkZEV2ZW50TGlzdGVuZXIiLCJwbGF5UG9kb21vcm8iLCJwYXVzZVBvZG9tb3JvIiwic3RvcFBvZG9tb3JvIiwic2Vzc2lvblRpbWUiLCJpbm5lckhUTUwiLCJkaXN0YW5jZVBlclBvaW50IiwiZHJhd0ZQUyIsIm9yaWciLCJsZW5ndGgiLCJ0aW1lciIsInN0YXJ0RHJhd2luZ1BhdGgiLCJzdG9wRHJhd2luZ1BhdGgiLCJzdHlsZSIsInN0cm9rZSIsImluY3JlYXNlTGVuZ3RoIiwicGF0aExlbmd0aCIsImdldFRvdGFsTGVuZ3RoIiwic3Ryb2tlRGFzaGFycmF5Iiwiam9pbiIsImNvbnNvbGUiLCJsb2ciXSwibWFwcGluZ3MiOiI7O0FBQUMsYUFBVztBQUNWO0FBQ0EsTUFBSUEsVUFBVUMsU0FBU0MsYUFBVCxDQUF1QixPQUF2QixDQUFkO0FBQUEs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QUFjaUMsS0FBZDtBQUNBRixTQUFLSyxLQUFMLENBQVdDLE1BQVgsR0FBb0IsRUFBcEI7QUFDQU4sU0FBS0ssS0FBTCxDQUFXSyxlQUFYLEdBQTZCLEVBQTdCO0FBQ0Q7QUFFRixDQS9MQSxHQUFELEMsQ0ErTEsiLCJmaWxlIjoic2NyaXB0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCkge1xuICAvL3RpbWVyXG4gIGxldCBkaXNwbGF5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnRpbWUnKSxhbmltLCB3YXRjaCAsXG4gIGRpc3BsYXlCcmVhayA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5icmVhay10aW1lJyksd2F0Y2hCcmVhayAsIGFuaW1CcmVha1xuICBcbiAgLy8gZGVmaW5lIGZ1bmN0aW9uIGZvciBzZXRJbnRlcnZhbFxuICBmdW5jdGlvbiBnZXRTZWNvbmRzKGhvdXIpIHtcbiAgICBsZXQgbWluID0gaG91ci50ZXh0Q29udGVudC5zcGxpdCgnOicpXG4gICAgcmV0dXJuIHBhcnNlSW50KG1pblswXSwgMTApKiA2MFxuICB9XG4gIC8vIGRlZmluZSBmdW5jdGlvbiBmb3Igc2V0SW50ZXJ2YWxcbiAgZnVuY3Rpb24gY2lyY3VsYXJMb29wKGluaXQsIG1pbiwgYWN0aW9uKSB7XG4gICAgbGV0IGN1cnJlbnQgPSBpbml0O1xuICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgIGFjdGlvbihjdXJyZW50KTtcbiAgICAgIGlmIChjdXJyZW50IC0gMSA9PT0gbWluKSB7XG4gICAgICAgIGN1cnJlbnQgPSBtaW47XG4gICAgICB9IGVsc2UgaWYoY3VycmVudCA+IDApe1xuICAgICAgICBjdXJyZW50LS07XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHdhdGNoID0gKCkgPT4ge1xuICAgIGxldCBzZWNvbmRzLCBtaW51dGVzO1xuICAgICAgYW5pbSA9IHNldEludGVydmFsKGNpcmN1bGFyTG9vcChnZXRTZWNvbmRzKGRpc3BsYXkpICwgMCwgZnVuY3Rpb24oY3VyclNlY29uZCkge1xuICAgICAgLy9wYXJzZUludCgpIHJldHVybiBpbnRlZ2VyIGV4IDExMC8gNjAgPSAxLjgzMzMzIHdpdGggcGFyc2VJbnQgaXQncyAxXG4gICAgICAvL0knbSB1c2luZyBNYXRoLmZsb29yLCBib3RoIGRvIHRoZSBzYW1lIHdvcmtcbiAgICAgIG1pbnV0ZXMgPSBwYXJzZUludChjdXJyU2Vjb25kICAvIDYwLCAxMCk7XG4gICAgICAvLyBzZWNvbmRzID0gMTIycyAvIDYwID0gMTIwIGFuZCByZW1haW4gMlxuICAgICAgc2Vjb25kcyA9IHBhcnNlSW50KGN1cnJTZWNvbmQgICUgNjAsIDEwKTtcblxuICAgICAgLy9wcmludCBhIDAgZmlyc3QgaWYgbWludXN0ZSBpcyBsZXNzIHRoYW4gMTAgbWludXRlcyBcbiAgICAgIG1pbnV0ZXMgPSBtaW51dGVzIDwgMTAgPyBcIjBcIiArIG1pbnV0ZXMgOiBtaW51dGVzO1xuICAgICAgc2Vjb25kcyA9IHNlY29uZHMgPCAxMCA/IFwiMFwiICsgc2Vjb25kcyA6IHNlY29uZHM7XG4gICAgICBkaXNwbGF5LnRleHRDb250ZW50ID0gbWludXRlcyArIFwiOlwiICsgc2Vjb25kcztcblxuICAgICAgaWYgKGN1cnJTZWNvbmQgPT09IDApIHtcbiAgICAgICAgY2xlYXJJbnRlcnZhbChhbmltKVxuICAgICAgICB3YXRjaEJyZWFrKClcbiAgICAgIH1cbiAgICB9KSwgMTAwMCk7XG4gIH1cbiAgd2F0Y2hCcmVhayA9ICgpID0+IHtcbiAgICBsZXQgc2Vjb25kcywgbWludXRlcztcbiAgICAgIGFuaW1CcmVhayA9IHNldEludGVydmFsKGNpcmN1bGFyTG9vcChnZXRTZWNvbmRzKGRpc3BsYXlCcmVhaykgLCAwLCBmdW5jdGlvbihjdXJyU2Vjb25kKSB7XG4gICAgICBtaW51dGVzID0gcGFyc2VJbnQoY3VyclNlY29uZCAgLyA2MCwgMTApO1xuICAgICAgc2Vjb25kcyA9IHBhcnNlSW50KGN1cnJTZWNvbmQgICUgNjAsIDEwKTtcbiAgICAgIG1pbnV0ZXMgPSBtaW51dGVzIDwgMTAgPyBcIjBcIiArIG1pbnV0ZXMgOiBtaW51dGVzO1xuICAgICAgc2Vjb25kcyA9IHNlY29uZHMgPCAxMCA/IFwiMFwiICsgc2Vjb25kcyA6IHNlY29uZHM7XG4gICAgICBkaXNwbGF5LnRleHRDb250ZW50ID0gbWludXRlcyArIFwiOlwiICsgc2Vjb25kcztcbiAgICAgIGlmIChjdXJyU2Vjb25kID09PSAwKSB7XG4gICAgICAgIGNsZWFySW50ZXJ2YWwoYW5pbUJyZWFrKVxuICAgICAgfVxuICAgIH0pLCAxMDAwKTtcbiAgfVxuICAvL0VORCBUSU1FUlxuXG4gIC8vRXZlbnQgKyBhbmQgLVxuICAvL1xuICBsZXQgc2Vzc2lvblBsdXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2Vzc2lvbl9fcGx1cycpLFxuICAgIHNlc3Npb25NaW51cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zZXNzaW9uX19taW51cycpLFxuICAgIGJyZWFrUGx1cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5icmVha19fcGx1cycpLFxuICAgIGJyZWFrTWludXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYnJlYWtfX21pbnVzJyksXG4gICAgdGltZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy50aW1lJyksXG4gICAgYnJlYWtUaW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmJyZWFrLXRpbWUnKSxcbiAgICBwbGF5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBsYXknKSxcbiAgICBzdG9wID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmljb24tc3RvcCcpLFxuICAgIHBhdXNlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBhdXNlJylcblxuICBmdW5jdGlvbiBwcmV2aW91c01pbnVzIChlKSB7XG4gICAgbGV0IHByZXY9IHRoaXMucHJldmlvdXNTaWJsaW5nLFxuICAgICAgdmFsID0gcGFyc2VJbnQocHJldi50ZXh0Q29udGVudCwgMTApXG4gICAgaWYgKHZhbCA+IDApIHtcbiAgICAgIHByZXYudGV4dENvbnRlbnQtLVxuICAgICAgaWYgKHZhbCA9PT0gMSkge1xuICAgICAgICBwcmV2LmNsYXNzTGlzdC5hZGQoJ2FsZXJ0JylcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKCF0aGlzLmNsYXNzTGlzdC5jb250YWlucygnYnJlYWtfX21pbnVzJykpIHtcbiAgICAgIHRpbWUudGV4dENvbnRlbnQgPSBwcmV2LnRleHRDb250ZW50ICsgJzowMCdcbiAgICAgIGNsZWFySW50ZXJ2YWwoYW5pbSlcbiAgICB9IGVsc2V7XG4gICAgICBicmVha1RpbWUudGV4dENvbnRlbnQgPSBwcmV2LnRleHRDb250ZW50ICsgJzowMCdcblxuICAgIH0gXG5cbiAgICBwbGF5LmNsYXNzTGlzdC5hZGQoJ3Nob3cnKVxuICAgIHBsYXkuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZScpXG4gICAgcGF1c2UuY2xhc3NMaXN0LmFkZCgnaGlkZScpXG4gICAgcGF1c2UuY2xhc3NMaXN0LnJlbW92ZSgnc2hvdycpXG4gICAgc3RvcC5jbGFzc0xpc3QucmVtb3ZlKCdzaG93JylcbiAgICBzdG9wLmNsYXNzTGlzdC5hZGQoJ2hpZGUnKVxuXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICB9XG4gIGZ1bmN0aW9uIG5leHRQbHVzKGUpIHtcbiAgICBsZXQgbmV4dCA9IHRoaXMubmV4dFNpYmxpbmdcbiAgICBsZXQgdmFsID0gcGFyc2VJbnQobmV4dC50ZXh0Q29udGVudCwgMTApXG4gICAgbmV4dC50ZXh0Q29udGVudCsrXG4gICAgaWYgKHZhbCA9PT0gMCkge1xuICAgICAgbmV4dC5jbGFzc0xpc3QucmVtb3ZlKCdhbGVydCcpXG4gICAgfVxuICAgIGlmICghdGhpcy5jbGFzc0xpc3QuY29udGFpbnMoJ2JyZWFrX19wbHVzJykpIHtcbiAgICAgIHRpbWUudGV4dENvbnRlbnQgPSBuZXh0LnRleHRDb250ZW50ICsgJzowMCdcbiAgICAgIGNsZWFySW50ZXJ2YWwoYW5pbSlcbiAgICB9IGVsc2V7XG4gICAgICBicmVha1RpbWUudGV4dENvbnRlbnQgPSBuZXh0LnRleHRDb250ZW50ICsgJzowMCdcbiAgICB9IFxuICAgIHBsYXkuY2xhc3NMaXN0LmFkZCgnc2hvdycpXG4gICAgcGxheS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRlJylcbiAgICBwYXVzZS5jbGFzc0xpc3QuYWRkKCdoaWRlJylcbiAgICBwYXVzZS5jbGFzc0xpc3QucmVtb3ZlKCdzaG93JylcbiAgICBzdG9wLmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3cnKVxuICAgIHN0b3AuY2xhc3NMaXN0LmFkZCgnaGlkZScpXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICB9XG5cbiAgc2Vzc2lvbk1pbnVzLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJyxwcmV2aW91c01pbnVzICk7XG4gIHNlc3Npb25QbHVzLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgbmV4dFBsdXMpO1xuICBicmVha01pbnVzLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJyxwcmV2aW91c01pbnVzICk7XG4gIGJyZWFrUGx1cy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG5leHRQbHVzKTtcbiAgcGxheS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHBsYXlQb2RvbW9ybyk7XG4gIHBhdXNlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgcGF1c2VQb2RvbW9ybyk7XG4gIHN0b3AuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBzdG9wUG9kb21vcm8pO1xuXG4gIGZ1bmN0aW9uIHBsYXlQb2RvbW9ybyhlKSB7XG4gICAgd2F0Y2goZGlzcGxheSlcbiAgICBwbGF5LmNsYXNzTGlzdC5hZGQoJ2hpZGUnKVxuICAgIHBsYXkuY2xhc3NMaXN0LnJlbW92ZSgnc2hvdycpXG4gICAgcGF1c2UuY2xhc3NMaXN0LmFkZCgnc2hvdycpXG4gICAgcGF1c2UuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZScpXG4gICAgc3RvcC5jbGFzc0xpc3QucmVtb3ZlKCdoaWRlJylcbiAgICBzdG9wLmNsYXNzTGlzdC5hZGQoJ3Nob3cnKVxuICAgIHN0b3AuY2xhc3NMaXN0LnJlbW92ZSgncGF1c2UnKVxuICB9XG4gIGZ1bmN0aW9uIHBhdXNlUG9kb21vcm8oZSkge1xuICAgIGNsZWFySW50ZXJ2YWwoYW5pbSlcbiAgICBwbGF5LmNsYXNzTGlzdC5hZGQoJ3Nob3cnKVxuICAgIHBsYXkuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZScpXG4gICAgcGF1c2UuY2xhc3NMaXN0LmFkZCgnaGlkZScpXG4gICAgcGF1c2UuY2xhc3NMaXN0LnJlbW92ZSgnc2hvdycpXG4gICAgc3RvcC5jbGFzc0xpc3QuYWRkKCdwYXVzZScpXG5cbiAgfVxuICBmdW5jdGlvbiBzdG9wUG9kb21vcm8oZSkge1xuICAgIGNsZWFySW50ZXJ2YWwoYW5pbSlcbiAgICBjbGVhckludGVydmFsKGFuaW1CcmVhaylcbiAgICBwbGF5LmNsYXNzTGlzdC5hZGQoJ3Nob3cnKVxuICAgIHBsYXkuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZScpXG4gICAgcGF1c2UuY2xhc3NMaXN0LmFkZCgnaGlkZScpXG4gICAgcGF1c2UuY2xhc3NMaXN0LnJlbW92ZSgnc2hvdycpXG4gICAgc3RvcC5jbGFzc0xpc3QucmVtb3ZlKCdzaG93JylcbiAgICBzdG9wLmNsYXNzTGlzdC5hZGQoJ2hpZGUnKVxuICAgIGxldCBzZXNzaW9uVGltZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zZXNzaW9uX190aW1lICcpLmlubmVySFRNTFxuICAgIHRpbWUudGV4dENvbnRlbnQgPSBzZXNzaW9uVGltZSAgKyAnOjAwJ1xuICB9XG4gIC8vU1ZHXG4gIC8vdHJhbnNmb3JtIHNlY29uZCB0byBwZXJpbWV0cmVcbiAgLy9wYXRoKHN0cm9rZS1kYXNoYXJyYXk9JzQ3MicsIHN0cm9rZS1kYXNob2Zmc2V0PScwLjAwJywgXFxcbiAgLy8xPT0gMXMgZG9uYyA0NzIgc2VjID0gNy44IG1pbnV0ZXMgc29pdCA0NzIvNjAgcG91ciBhdm9pciBsZXMgbWludXRlc1xuICAvL21pbiAqIDYwID0gc2Vjb25kcyBcbiAgLy9kb25jIDEwbWluICogNjAgb24gb2J0aWVudCBsZSByZXN1dGF0IGVuIHNlY29uZGUgZXQgbGUgZGlhbWV0cmUgZHUgXG4gIC8vcGVyaW1ldHJlXG4gIGxldCBkaXN0YW5jZVBlclBvaW50ID0gMTtcbiAgbGV0IGRyYXdGUFMgICAgICAgICAgPSAxMDAwLzEwO1xuICBsZXQgb3JpZyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ3BhdGgnKSwgbGVuZ3RoLCB0aW1lcjtcblxuICBvcmlnLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlb3Zlcicsc3RhcnREcmF3aW5nUGF0aCx0cnVlKTtcbiAgb3JpZy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW91dCcsIHN0b3BEcmF3aW5nUGF0aCwgdHJ1ZSk7XG5cbiAgZnVuY3Rpb24gc3RhcnREcmF3aW5nUGF0aCgpe1xuICAgIGxlbmd0aCA9IDA7XG4gICAgb3JpZy5zdHlsZS5zdHJva2UgPSAnI2Y2MCc7XG4gICAgdGltZXIgPSBzZXRJbnRlcnZhbChpbmNyZWFzZUxlbmd0aCwgMTAwMCApO1xuICB9XG5cbiAgZnVuY3Rpb24gaW5jcmVhc2VMZW5ndGgoKXtcbiAgICB2YXIgcGF0aExlbmd0aCA9IG9yaWcuZ2V0VG90YWxMZW5ndGgoKTtcbiAgICBsZW5ndGggKz0gZGlzdGFuY2VQZXJQb2ludDtcbiAgICAvL2xlbmd0aD0wIGFuZCBwYXRoIGxlbmdodCA9IHN0cm9rZS1kYXNoYXJyYXkgc29pdCA0NzJcbiAgICBvcmlnLnN0eWxlLnN0cm9rZURhc2hhcnJheSA9IFtsZW5ndGgscGF0aExlbmd0aF0uam9pbignICcpO1xuICAgIGNvbnNvbGUubG9nKFtsZW5ndGgscGF0aExlbmd0aF0uam9pbignICcpKTtcbiAgICBpZiAobGVuZ3RoID49IHBhdGhMZW5ndGgpIGNsZWFySW50ZXJ2YWwodGltZXIpO1xuICB9XG5cbiAgZnVuY3Rpb24gc3RvcERyYXdpbmdQYXRoKCl7XG4gICAgY2xlYXJJbnRlcnZhbCh0aW1lcik7XG4gICAgb3JpZy5zdHlsZS5zdHJva2UgPSAnJztcbiAgICBvcmlnLnN0eWxlLnN0cm9rZURhc2hhcnJheSA9ICcnO1xuICB9XG5cbn0oKSk7Ly9FTkRcblxuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
